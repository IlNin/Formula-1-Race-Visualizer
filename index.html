<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
        <title>Formula 1 VA Project</title>
        <script type="text/javascript" src="d3.js"></script>
        <style>
            #title {
                border: 3px solid black;
                padding-left: 5px;
                padding-right: 5px;
                padding-bottom: 5px;
                display: inline-block;
                background: yellow;
                text-align: center;
            }
        </style>
	</head>
    
    <body>
    <script>
    function init() {
        title = document.createElement('div');
        title.id = "title";
        title.innerHTML = "<h1>Formula 1 Visual Analytics Project</h1>";
        title.innerHTML += "Please select a race: ";
        document.body.appendChild(title);
    
        selectSeason = document.createElement('select');
        selectSeason.id = "select-season";
        defaultSeasonOption = document.createElement('option');
        defaultSeasonOption.value = 0;
        defaultSeasonOption.innerHTML = "- SEASON -";
        selectSeason.appendChild(defaultSeasonOption);
        title.appendChild(selectSeason);
        title.innerHTML += "&nbsp";
    
        selectRace = document.createElement('select');
        selectRace.id = "select-race";
        selectRace.style.width = '150px';
        defaultRaceOption = document.createElement('option');
        defaultRaceOption.value = 0;
        defaultRaceOption.innerHTML = "- RACE -";
        selectRace.appendChild(defaultRaceOption);
        title.appendChild(selectRace);
        title.innerHTML += "&nbsp";
    
        search = document.createElement('button');
        search.id = "search";
        search.innerHTML = "Search data!";
        search.disabled = true;
        title.appendChild(search);
        
        d3.csv("laps.csv", function(data) {
            seasons = [];
            data.forEach(function(d) {
                //console.log(d);
                if (!seasons.includes(d.year)) {
                    seasons.push(d.year);
                    newSeasonOption = document.createElement('option');
                    newSeasonOption.value = d.year;
                    newSeasonOption.innerHTML = d.year;
                    document.getElementById("select-season").appendChild(newSeasonOption);
                }
                document.getElementById("select-season").onchange = function() {loadRaces(data)};    
                document.getElementById("select-race").onchange = function() {ready(data)};
            });
        });
    }
    
    function loadRaces(data) {
        // RESTORE SELECTOR
        document.getElementById("search").disabled = true; // Disables the search button
        document.getElementById("select-race").value = 0; // Restore the race selector to the default option
        options = document.getElementById("select-race").options.length; // Removes all options inside the selector bar the default one
        for (i = options-1; i > 0; i--) {
            document.getElementById("select-race").options[i] = null;
        }
          
        // REFRESH SELECTOR
        year = document.getElementById("select-season").value; // Gets the year selected
        if (year > 0) { // A valid year, that is not the default option, is selected
            races = []; // Keeps track of unique races
            data.forEach(function(d) { // Goes through the data again to get all unique races for the year selected
                if (d.year == year && !races.includes(d.race)) {
                    races.push(d.race);
                    newRaceOption = document.createElement('option');
                    newRaceOption.value = d.round;
                    newRaceOption.innerHTML = d.race;
                    document.getElementById("select-race").appendChild(newRaceOption);
                }
            });
            
        }
    }
    
    function ready(data) {
        if (document.getElementById("select-race").value > 0) {
            document.getElementById("search").disabled = false;
        }
        else {
            document.getElementById("search").disabled = true;
        }
    }
    
    init();
    </script>
    </body>
</html>